<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mmrm">
<title> • mmrm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="mmrm">
<meta property="og:image" content="https://openpharma.github.io/mmrm/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125641273-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">mmrm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2.9040</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../../articles/algorithm.html">Details of the Model Fitting in `mmrm`</a>
    <a class="dropdown-item" href="../../articles/between_within.html">Between-Within degrees of freedom</a>
    <a class="dropdown-item" href="../../articles/coef_vcov.html">Coefficients Covariance Matrix Adjustment in `mmrm`</a>
    <a class="dropdown-item" href="../../articles/covariance.html">Covariance Structures in `mmrm`</a>
    <a class="dropdown-item" href="../../articles/empirical_wls.html">Weighted Least Square Empirical Covariance</a>
    <a class="dropdown-item" href="../../articles/introduction.html">Introduction to `mmrm`</a>
    <a class="dropdown-item" href="../../articles/kenward.html">Details of the Kenward-Roger calculations</a>
    <a class="dropdown-item" href="../../articles/methodological_introduction.html">What are MMRMs? A brief introduction</a>
    <a class="dropdown-item" href="../../articles/mmrm_review_methods.html">Implementations of MMRM: a comparison of what's available</a>
    <a class="dropdown-item" href="../../articles/package_structure.html">Package Structure</a>
    <a class="dropdown-item" href="../../articles/predict.html">Predicting from a MMRM</a>
    <a class="dropdown-item" href="../../articles/satterthwaite.html">Details of the Satterthwaite calculations</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-acknowledgments.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-customizations.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-getting_started.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-hypothesis_testing.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-lower_level.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-model_features.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../../articles/subsections/intro-tidymodels.html">UNKNOWN TITLE</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../news/index.html">Changelog</a>
</li>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://openpharma.github.io/mmrm/v0.2.2">v0.2.2</a> </div></li>
<!-- end dropdown for versions -->
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reports">Reports</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reports">
    <a class="dropdown-item" href="../../coverage-report/">Coverage report</a>
    <a class="dropdown-item" href="../../unit-test-report/">Unit test report</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/openpharma/mmrm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.svg" class="logo" alt=""><h1></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/mmrm/blob/HEAD/vignettes/subsections/intro-tidymodels.Rmd" class="external-link"><code>vignettes/subsections/intro-tidymodels.Rmd</code></a></small>
      <div class="d-none name"><code>intro-tidymodels.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="tidymodels">Tidymodels<a class="anchor" aria-label="anchor" href="#tidymodels"></a>
</h2>
<p><code>mmrm</code> is compatible to work in a <code>tidymodels</code>
workflow. The following is an example of how such a workflow would be
constructed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="direct-fit">Direct fit<a class="anchor" aria-label="anchor" href="#direct-fit"></a>
</h3>
<p>First we define the direct method to fit an mmrm model using the
parsnip package functions <code>linear_reg()</code> and
<code>set_engine()</code>.</p>
<ul>
<li>
<code>linear_reg()</code> defines a model that can predict numeric
values from predictors using a linear function</li>
<li>
<code>set_engine()</code> is used to specify which package or system
will be used to fit the model, along with any arguments specific to that
software. We can set the method to adjust degrees of freedom directly in
the call.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"mmrm"</span>, method <span class="op">=</span> <span class="st">"Satterthwaite"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">FEV1</span> <span class="op">~</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="fu">us</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span>, <span class="va">fev_data</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## parsnip model object</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## mmrm fit</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:     FEV1 ~ RACE + ARMCD * AVISIT + us(AVISIT | USUBJID)</span></span>
<span><span class="co">## Data:        data (used 537 observations from 197 subjects with maximum 4 </span></span>
<span><span class="co">## timepoints)</span></span>
<span><span class="co">## Weights:     weights</span></span>
<span><span class="co">## Covariance:  unstructured (10 variance parameters)</span></span>
<span><span class="co">## Inference:   REML</span></span>
<span><span class="co">## Deviance:    3387.373</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients: </span></span>
<span><span class="co">##                   (Intercept) RACEBlack or African American </span></span>
<span><span class="co">##                   30.96769899                    1.50464863 </span></span>
<span><span class="co">##                     RACEWhite                      ARMCDTRT </span></span>
<span><span class="co">##                    5.61309565                    3.77555734 </span></span>
<span><span class="co">##                    AVISITVIS2                    AVISITVIS3 </span></span>
<span><span class="co">##                    4.82858803                   10.33317002 </span></span>
<span><span class="co">##                    AVISITVIS4           ARMCDTRT:AVISITVIS2 </span></span>
<span><span class="co">##                   15.05255715                   -0.01737409 </span></span>
<span><span class="co">##           ARMCDTRT:AVISITVIS3           ARMCDTRT:AVISITVIS4 </span></span>
<span><span class="co">##                   -0.66753189                    0.63094392 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model Inference Optimization:</span></span>
<span><span class="co">## Converged with code 0 and message: convergence: rel_reduction_of_f &lt;= factr*epsmch</span></span></code></pre>
<p>We can also pass in the full <code>mmrm_control</code> object into
the <code>set_engine()</code> call</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_with_control</span> <span class="op">&lt;-</span> <span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"mmrm"</span>, control <span class="op">=</span> <span class="fu"><a href="../../reference/mmrm_control.html">mmrm_control</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"Satterthwaite"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">FEV1</span> <span class="op">~</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="fu">us</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span>, <span class="va">fev_data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-mmrm-in-workflows">Using mmrm in workflows<a class="anchor" aria-label="anchor" href="#using-mmrm-in-workflows"></a>
</h3>
<p>We can leverage the <code>workflows</code> package in order to fit
the same model.</p>
<ul>
<li>First we define the specification for linear regression with the
mmrm engine.</li>
<li>Second we define the workflow, by defining the outcome and
predictors that will be used in the formula. We then add the model using
the formula.</li>
<li>Lastly, we fit the model</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mmrm_spec</span> <span class="op">&lt;-</span> <span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"mmrm"</span>, method <span class="op">=</span> <span class="st">"Satterthwaite"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mmrm_wflow</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_variables</span><span class="op">(</span>outcomes <span class="op">=</span> <span class="va">FEV1</span>, predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">RACE</span>, <span class="va">ARMCD</span>, <span class="va">AVISIT</span>, <span class="va">USUBJID</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">mmrm_spec</span>, formula <span class="op">=</span> <span class="va">FEV1</span> <span class="op">~</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="fu">us</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mmrm_wflow</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">fit</span><span class="op">(</span>data <span class="op">=</span> <span class="va">fev_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ══ Workflow [trained] ══════════════════════════════════════════════════════════</span></span>
<span><span class="co">## <span style="font-style: italic;">Preprocessor:</span> Variables</span></span>
<span><span class="co">## <span style="font-style: italic;">Model:</span> linear_reg()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## Outcomes: FEV1</span></span>
<span><span class="co">## Predictors: c(RACE, ARMCD, AVISIT, USUBJID)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## mmrm fit</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:     FEV1 ~ RACE + ARMCD * AVISIT + us(AVISIT | USUBJID)</span></span>
<span><span class="co">## Data:        data (used 537 observations from 197 subjects with maximum 4 </span></span>
<span><span class="co">## timepoints)</span></span>
<span><span class="co">## Weights:     weights</span></span>
<span><span class="co">## Covariance:  unstructured (10 variance parameters)</span></span>
<span><span class="co">## Inference:   REML</span></span>
<span><span class="co">## Deviance:    3387.373</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients: </span></span>
<span><span class="co">##                   (Intercept) RACEBlack or African American </span></span>
<span><span class="co">##                   30.96769899                    1.50464863 </span></span>
<span><span class="co">##                     RACEWhite                      ARMCDTRT </span></span>
<span><span class="co">##                    5.61309565                    3.77555734 </span></span>
<span><span class="co">##                    AVISITVIS2                    AVISITVIS3 </span></span>
<span><span class="co">##                    4.82858803                   10.33317002 </span></span>
<span><span class="co">##                    AVISITVIS4           ARMCDTRT:AVISITVIS2 </span></span>
<span><span class="co">##                   15.05255715                   -0.01737409 </span></span>
<span><span class="co">##           ARMCDTRT:AVISITVIS3           ARMCDTRT:AVISITVIS4 </span></span>
<span><span class="co">##                   -0.66753189                    0.63094392 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model Inference Optimization:</span></span>
<span><span class="co">## Converged with code 0 and message: convergence: rel_reduction_of_f &lt;= factr*epsmch</span></span></code></pre>
<p>We can separate out the data preparation step from the modeling step
using the <code>recipes</code> package. Here we are converting the
<code>ARMCD</code> variable into a dummy variable and creating an
interaction term with the new dummy variable and each visit.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mmrm_recipe</span> <span class="op">&lt;-</span> <span class="fu">recipe</span><span class="op">(</span><span class="va">FEV1</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">fev_data</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">step_dummy</span><span class="op">(</span><span class="va">ARMCD</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">step_interact</span><span class="op">(</span>terms <span class="op">=</span> <span class="op">~</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"ARMCD"</span><span class="op">)</span><span class="op">:</span><span class="va">AVISIT</span><span class="op">)</span></span></code></pre></div>
<p>Using <code>prep()</code> and <code>juice()</code> we can see what
the transformed data that will be used in the model fit looks like.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mmrm_recipe</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">prep</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">juice</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 800 × 13</span></span></span>
<span><span class="co">##    USUBJID AVISIT RACE       SEX   FEV1_BL WEIGHT VISITN VISITN2  FEV1 ARMCD_TRT</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> PT1     VIS1   Black or … Fema…    25.3  0.677      1  -<span style="color: #BB0000;">0.626</span>  <span style="color: #BB0000;">NA</span>           1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> PT1     VIS2   Black or … Fema…    25.3  0.801      2   0.184  40.0         1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> PT1     VIS3   Black or … Fema…    25.3  0.709      3  -<span style="color: #BB0000;">0.836</span>  <span style="color: #BB0000;">NA</span>           1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> PT1     VIS4   Black or … Fema…    25.3  0.809      4   1.60   20.5         1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> PT2     VIS1   Asian      Male     45.0  0.465      1   0.330  <span style="color: #BB0000;">NA</span>           0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> PT2     VIS2   Asian      Male     45.0  0.233      2  -<span style="color: #BB0000;">0.820</span>  31.5         0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> PT2     VIS3   Asian      Male     45.0  0.360      3   0.487  36.9         0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> PT2     VIS4   Asian      Male     45.0  0.507      4   0.738  48.8         0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> PT3     VIS1   Black or … Fema…    43.5  0.682      1   0.576  <span style="color: #BB0000;">NA</span>           0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> PT3     VIS2   Black or … Fema…    43.5  0.892      2  -<span style="color: #BB0000;">0.305</span>  36.0         0</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 790 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 3 more variables: ARMCD_TRT_x_AVISITVIS2 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ARMCD_TRT_x_AVISITVIS3 &lt;dbl&gt;, ARMCD_TRT_x_AVISITVIS4 &lt;dbl&gt;</span></span></span></code></pre>
<p>We can pass the covariance structure as well in the
<code>set_engine()</code> definition. This allows for more flexibility
on presetting different covariance structures in the pipeline while
keeping the data preparation step independent.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mmrm_spec_with_cov</span> <span class="op">&lt;-</span> <span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span></span>
<span>    <span class="st">"mmrm"</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"Satterthwaite"</span>,</span>
<span>    covariance <span class="op">=</span> <span class="fu"><a href="../../reference/as.cov_struct.html">as.cov_struct</a></span><span class="op">(</span><span class="op">~</span> <span class="fu">us</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We combine these steps into a workflow:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">mmrm_wflow_nocov</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">mmrm_spec_with_cov</span>, formula <span class="op">=</span> <span class="va">FEV1</span> <span class="op">~</span> <span class="va">SEX</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">mmrm_recipe</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ══ Workflow ════════════════════════════════════════════════════════════════════</span></span>
<span><span class="co">## <span style="font-style: italic;">Preprocessor:</span> Recipe</span></span>
<span><span class="co">## <span style="font-style: italic;">Model:</span> linear_reg()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## 2 Recipe Steps</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## • step_dummy()</span></span>
<span><span class="co">## • step_interact()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## Linear Regression Model Specification (regression)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Engine-Specific Arguments:</span></span>
<span><span class="co">##   method = Satterthwaite</span></span>
<span><span class="co">##   covariance = as.cov_struct(~us(AVISIT | USUBJID))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Computational engine: mmrm</span></span></code></pre>
<p>Last step is to fit the data with the workflow object</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">fit_tidy</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">mmrm_wflow_nocov</span>, data <span class="op">=</span> <span class="va">fev_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ══ Workflow [trained] ══════════════════════════════════════════════════════════</span></span>
<span><span class="co">## <span style="font-style: italic;">Preprocessor:</span> Recipe</span></span>
<span><span class="co">## <span style="font-style: italic;">Model:</span> linear_reg()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## 2 Recipe Steps</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## • step_dummy()</span></span>
<span><span class="co">## • step_interact()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## mmrm fit</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:     FEV1 ~ SEX</span></span>
<span><span class="co">## Data:        data (used 537 observations from 197 subjects with maximum 4 </span></span>
<span><span class="co">## timepoints)</span></span>
<span><span class="co">## Weights:     weights</span></span>
<span><span class="co">## Covariance:  unstructured (10 variance parameters)</span></span>
<span><span class="co">## Inference:   REML</span></span>
<span><span class="co">## Deviance:    3699.803</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients: </span></span>
<span><span class="co">## (Intercept)   SEXFemale </span></span>
<span><span class="co">## 42.80540973  0.04513432 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model Inference Optimization:</span></span>
<span><span class="co">## Converged with code 0 and message: convergence: rel_reduction_of_f &lt;= factr*epsmch</span></span></code></pre>
<p>To retrieve the fit object from within the workflow object run the
following</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">hardhat</span><span class="fu">::</span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_fit_engine</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## mmrm fit</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:     FEV1 ~ SEX</span></span>
<span><span class="co">## Data:        data (used 537 observations from 197 subjects with maximum 4 </span></span>
<span><span class="co">## timepoints)</span></span>
<span><span class="co">## Weights:     weights</span></span>
<span><span class="co">## Covariance:  unstructured (10 variance parameters)</span></span>
<span><span class="co">## Inference:   REML</span></span>
<span><span class="co">## Deviance:    3699.803</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients: </span></span>
<span><span class="co">## (Intercept)   SEXFemale </span></span>
<span><span class="co">## 42.80540973  0.04513432 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model Inference Optimization:</span></span>
<span><span class="co">## Converged with code 0 and message: convergence: rel_reduction_of_f &lt;= factr*epsmch</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Daniel Sabanes Bove, Julia Dedic, Doug Kelkhoff, Kevin Kunzmann, Brian Matthew Lang, Liming Li, Christian Stock, Ya Wang, Dan James, Jonathan Sidi, Daniel D. Sjoberg, Boehringer Ingelheim Ltd., Gilead Sciences, Inc., F. Hoffmann-La Roche AG, Merck Sharp &amp; Dohme, Inc., AstraZeneca plc.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
